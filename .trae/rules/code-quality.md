# 代码质量规范

## 基本原则

1. **可读性优先**: 代码应该像散文一样清晰易懂
2. **简洁性**: 避免不必要的复杂性,保持代码简洁
3. **一致性**: 遵循项目既定的代码风格和模式
4. **可维护性**: 编写易于修改和扩展的代码

## 命名规范

### 变量和函数
- 使用有意义的名称,避免缩写(除非是广泛认可的缩写)
- 变量名使用小写字母和下划线:`user_name`, `total_price`
- 函数名使用动词开头:`calculate_total()`, `validate_input()`
- 布尔变量使用 `is_`, `has_`, `should_` 前缀:`is_valid`, `has_permission`

### 类和常量
- 类名使用大驼峰命名法:`UserService`, `OrderManager`
- 常量使用全大写和下划线:`MAX_RETRY_COUNT`, `API_BASE_URL`

## 代码结构

### 函数设计
- 单一职责:每个函数只做一件事
- 函数长度:理想情况下不超过 20-30 行
- 参数数量:不超过 4 个参数,超过时考虑使用对象或配置字典
- 返回值:明确返回值的含义,避免返回 None

### 类设计
- 高内聚低耦合:类内部紧密相关,类之间依赖最小
- 封装性:隐藏内部实现细节,暴露必要的接口
- 继承谨慎:优先使用组合而非继承

## 错误处理

### 异常处理
- 捕获特定的异常,避免使用裸的 `except:`
- 提供有意义的错误信息
- 在适当的地方记录错误日志
- 考虑使用自定义异常类

### 输入验证
- 验证所有外部输入(用户输入、API 响应、文件内容)
- 使用类型注解提高代码可读性
- 提供清晰的验证错误信息

## 注释规范

### 何时添加注释
- 解释"为什么"而不是"是什么"
- 记录复杂算法的思路
- 说明设计决策的原因
- 标记待办事项和已知问题

### 注释风格
- 使用清晰简洁的语言
- 保持注释与代码同步更新
- 避免过时的注释

## 性能考虑

### 优化原则
- 过早优化是万恶之源
- 先保证正确性,再考虑性能
- 使用性能分析工具识别瓶颈
- 优先优化热点代码

### 资源管理
- 及时释放不再使用的资源
- 使用上下文管理器管理资源
- 避免内存泄漏

## 安全规范

### 敏感信息
- 永远不要硬编码密码、API 密钥等敏感信息
- 使用环境变量或配置文件管理敏感信息
- 不要在日志中记录敏感数据

### 输入安全
- 防止 SQL 注入:使用参数化查询
- 防止 XSS 攻击:对用户输入进行转义
- 验证和清理所有外部输入

## 测试要求

### 单元测试
- 核心功能必须有单元测试
- 测试覆盖率不低于 80%
- 使用有意义的测试名称
- 遵循 AAA 模式:Arrange, Act, Assert

### 测试边界情况
- 测试正常情况
- 测试边界情况(空值、极值、非法值)
- 测试异常情况

## 文档要求

### 代码文档
- 公共 API 必须有文档字符串
- 文档包含:功能描述、参数说明、返回值说明、示例
- 保持文档与代码同步

### 项目文档
- README 文件说明项目用途和基本使用方法
- CHANGELOG 记录版本变更
- 架构文档说明系统设计

## 版本控制

### 提交信息
- 使用清晰的提交信息
- 提交信息格式:`<type>: <description>`
  - `feat`: 新功能
  - `fix`: 修复 bug
  - `docs`: 文档更新
  - `refactor`: 代码重构
  - `test`: 测试相关
  - `chore`: 构建/工具相关

### 分支策略
- `main`: 生产环境代码
- `develop`: 开发环境代码
- `feature/*`: 功能分支
- `bugfix/*`: 修复分支
- `hotfix/*`: 紧急修复分支