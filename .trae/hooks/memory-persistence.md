# 记忆持久化钩子

## 钩子描述

自动保存和恢复会话上下文,实现跨会话的记忆持久化,确保重要的项目信息不会丢失。

## 触发时机

- 会话开始时(恢复记忆)
- 会话结束时(保存记忆)
- 关键事件发生时(更新记忆)

## 功能特性

1. **自动保存**
   - 保存项目上下文
   - 保存重要决策
   - 保存待办事项
   - 保存问题解决方案

2. **智能恢复**
   - 恢复项目状态
   - 恢复工作进度
   - 恢复关键信息
   - 恢复上下文线索

3. **记忆管理**
   - 分类存储记忆
   - 设置记忆优先级
   - 清理过期记忆
   - 压缩冗余记忆

4. **上下文关联**
   - 关联相关记忆
   - 建立记忆索引
   - 支持记忆搜索
   - 提供记忆推荐

## 记忆类型

### 项目记忆
- 项目结构
- 技术栈
- 配置信息
- 依赖关系

### 工作记忆
- 当前任务
- 工作进度
- 待办事项
- 问题列表

### 知识记忆
- 技术决策
- 解决方案
- 最佳实践
- 经验教训

### 用户记忆
- 用户偏好
- 工作习惯
- 常用命令
- 历史记录

## 配置选项

```json
{
  "enabled": true,
  "triggers": {
    "on_start": true,
    "on_end": true,
    "on_task_complete": true,
    "on_decision": true
  },
  "storage": {
    "type": "file",
    "path": ".trae/memory/",
    "compression": true,
    "encryption": false
  },
  "retention": {
    "max_age": "30d",
    "max_size": "100MB",
    "priority": "importance"
  },
  "categories": {
    "project": {
      "enabled": true,
      "priority": "high"
    },
    "work": {
      "enabled": true,
      "priority": "high"
    },
    "knowledge": {
      "enabled": true,
      "priority": "medium"
    },
    "user": {
      "enabled": true,
      "priority": "medium"
    }
  }
}
```

## 记忆格式

```markdown
# 记忆条目

## 元数据
- ID: 唯一标识符
- 类型: 项目/工作/知识/用户
- 优先级: 高/中/低
- 创建时间: 时间戳
- 更新时间: 时间戳
- 标签: [标签1, 标签2]

## 内容
[记忆的具体内容]

## 关联
- 关联记忆: [ID1, ID2]
- 相关文件: [文件路径]
- 相关任务: [任务ID]

## 状态
- 状态: 活跃/归档/过期
- 访问次数: X
- 最后访问: 时间戳
```

## 使用示例

### 自动保存记忆
```
# 当完成一个任务时,自动保存
任务: 实现用户登录功能
状态: 已完成
关键决策: 使用 JWT 进行身份验证
技术栈: React, Node.js, MongoDB
```

### 恢复记忆
```
# 新会话开始时,自动恢复
项目: lin-showcase
当前任务: 实现用户登录功能
工作进度: 80%
待办事项: [添加密码重置功能, 优化登录表单]
```

### 更新记忆
```
# 当做出重要决策时,更新记忆
决策: 将数据库从 MongoDB 迁移到 PostgreSQL
原因: 需要更好的事务支持和关系型查询
影响: 需要修改数据访问层和迁移脚本
```

## 注意事项

- 记忆文件不应提交到版本控制
- 定期清理过期和冗余的记忆
- 保护敏感信息,不要保存密码和密钥
- 监控记忆存储空间,避免占用过多磁盘空间
- 提供记忆导出和导入功能,方便备份和迁移